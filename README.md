# Virtual assembler

This project provides an assembler and interpreter for a simple educational virtual machine (UVM). The UVM has a limited instruction set designed for learning the fundamentals of assembly language and virtual machine operation.

## Features

*   **Assembler:** Converts UVM assembly code into binary code executable by the interpreter.
*   **Interpreter:** Executes the binary code generated by the assembler.
*   **XML Logging:** Generates detailed logs of the assembly process in XML format.
*   **XML Output:** Stores the results of UVM program execution in a specified memory range to an XML file.

## UVM Instruction Set

The UVM supports the following instructions:

| Instruction   | Opcode (A) | Operand (B) | Description                                                                                           | Size (bytes) |
| :------------ | :--------- | :---------- | :---------------------------------------------------------------------------------------------------- | :----------- |
| `LOAD_MEM`    | 1          | Address     | Loads the value from the memory address specified in the accumulator into the accumulator.            | 2            |
| `LOAD_CONST`  | 2          | Constant    | Loads a constant value into the accumulator.                                                          | 2            |
| `STORE_MEM`   | 3          | Address     | Stores the value from the accumulator into the memory location specified by the operand.              | 2            |
| `SGN`         | 4          | N/A         | Performs the signum (sgn) function on the accumulator (result: 1 if > 0, -1 if < 0, 0 if = 0).        | 2            |

## Project Structure

*   `assembler.py`: Contains the `Assembler` class, responsible for assembling UVM code.
*   `uvm.py`: Contains the `UVM` class, which simulates the virtual machine and interprets binary code.
*   `main.py`: The main entry point for the application, handling command-line arguments and orchestrating the assembler and interpreter.
*   `config.py` - Contains constants for UVM instructions (opcodes).

## Usage

The program has two main modes: `assemble` and `interpret`.

### Assemble Mode

**Purpose:** Converts UVM assembly code into executable binary code.

**Command:**

```bash
python -m assembler.main assemble <input_file> <binary_file> <log_file>
```

**Arguments:**

*   `input_file`: Path to the text file containing UVM assembly code.
*   `binary_file`: Path to the output file where the generated binary code will be saved.
*   `log_file`: Path to the output XML file where the assembly log will be written.

**Example:**

```bash
python -m assembler.main assemble program.uvm program.bin log.xml
```

This command will assemble the code in `program.uvm`, save the binary to `program.bin`, and write the assembly log to `log.xml`.

### Interpret Mode

**Purpose:** Executes UVM binary code and saves the results.

**Command:**

```bash
python -m assembler.main interpret <binary_file> <result_file> <start_address> <end_address>
```

**Arguments:**

*   `binary_file`: Path to the binary file containing the compiled UVM program.
*   `result_file`: Path to the output XML file where the memory contents within the specified range will be saved.
*   `start_address`: The starting address of the memory range to be saved in the result file.
*   `end_address`: The ending address of the memory range to be saved in the result file.

**Example:**

```bash
python -m assembler.main interpret program.bin result.xml 0 15
```

This command will execute the binary code in `program.bin`, and save the memory contents from address 0 to 15 (inclusive) into `result.xml`.

## Example Program

Here's an example UVM program that demonstrates the `SGN` instruction applied to a vector of 8 elements:

```assembly
load_const 9
store_mem 0
load_const 23
store_mem 1
load_const -78
store_mem 2
load_const -9
store_mem 3
load_const 0
store_mem 4
load_const 12
store_mem 5
load_const -33
store_mem 6
load_const 3
store_mem 7
load_mem 0
sgn
store_mem 8
load_mem 1
sgn
store_mem 9
load_mem 2
sgn
store_mem 10
load_mem 3
sgn
store_mem 11
load_mem 4
sgn
store_mem 12
load_mem 5
sgn
store_mem 13
load_mem 6
sgn
store_mem 14
load_mem 7
sgn
store_mem 15
```

**Explanation:**

1. **Initialization:** The program first loads constants into memory locations 0 through 7, representing a vector of 8 numbers.
2. **SGN Operation:** Then, for each element in the vector (memory locations 0-7):
    *   It loads the element into the accumulator using `load_mem`.
    *   It applies the `sgn` operation.
    *   It stores the result into a new memory location (8-15), effectively creating a new vector with the results of the `sgn` operation.

To run this example:

1. Save the code above as `program.uvm`.
2. Assemble it: `python main.py assemble program.uvm program.bin log.xml`
3. Interpret it: `python main.py interpret program.bin result.xml 0 15`

After running these commands, `result.xml` will contain the contents of memory from address 0 to 15, showing the original vector and the resulting vector after the `sgn` operation. The `log.xml` will contain the detailed assembly log.
